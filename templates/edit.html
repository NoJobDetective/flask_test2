<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>プロジェクト編集</title>
  <!-- FontAwesome のCDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    form {
      margin-bottom: 30px;
    }
    .rating-container {
      margin-bottom: 20px;
    }
    .rating-container input[type="range"] {
      width: 300px;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h1>プロジェクト編集</h1>
  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}
  <form method="POST">
    <label for="url">URLを入力してください:</label>
    <input type="text" id="url" name="url" value="{{ project.url }}" required>
    <br><br>
    <label for="comment">URLに対する感想を入力してください:</label>
    <br>
    <textarea id="comment" name="comment" rows="4" cols="50">{{ project.comment }}</textarea>
    <br><br>
    <div class="rating-container">
      <label for="ratingRange">評価:</label>
      <input type="range" id="ratingRange" name="rating" min="0" max="5" step="0.5" value="{{ project.rating|default(3) }}">
      <span id="ratingDisplay"></span>
    </div>
    <button type="submit">更新</button>
  </form>
  <a href="{{ url_for('index') }}">戻る</a>
  
  <!-- JavaScript for updating rating display in edit -->
  <script>
    function updateRatingDisplay(val) {
      var r = parseFloat(val);
      var full = Math.floor(r);
      var half = (r - full) >= 0.5 ? 1 : 0;
      var empty = 5 - full - half;
      var stars = "";
      for (var i = 0; i < full; i++) {
        stars += "★";
      }
      if (half) {
        stars += "⯨";
      }
      for (var i = 0; i < empty; i++) {
        stars += "☆";
      }
      document.getElementById("ratingDisplay").innerText = stars;
    }
    document.getElementById("ratingRange").addEventListener("input", function() {
      updateRatingDisplay(this.value);
    });
    window.addEventListener("load", function() {
      updateRatingDisplay(document.getElementById("ratingRange").value);
    });
  </script>
</body>
</html>
